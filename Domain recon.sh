#!/bin/sh
# ECE 574 Lab Assignment
# Author: Rishabh Singh
##############################


_cat="/usr/bin/cat"
echo "${1}" > ip.txt
domain="$(${_cat} \
ip.txt | cut -d '@' -f 2)"
cat_url="$(${_cat} \
ip.txt | cut -d '.' -f 1)"
if [ ${cat_url} = 'www' ]
then
        domain="$(${_cat} \
        ip.txt | cut -d '.' -f 2,3,4,5,6,7,8)"
fi

_ping="/usr/bin/ping"
ping_test="$(${_ping} \
-c 1 \
${domain} | grep "transmitted" |  cut -d " " -f 4)"

if [ ${ping_test} != 1 ]
then
        echo "Entered IP or Domain is offline."
        echo "Please enter a valid input."
        echo "Syntax to follow: ./ece574ass.sh <IP/Domain/Email>"
        exit
fi

whois="/usr/bin/whois"
dig="/usr/bin/dig"
cat_op="$(${_cat} \
ip.txt | egrep -o "[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}")"

if [ -z ${cat_op} ]
then
        echo "............Entered Domain is alive................................................."
        whoisrun="$(${whois} \
        ${domain} | egrep "Domain Status|Name|Email|Organization|Phone|Country"| sed -e 's/^[ \t]*//' | tr -d '()' | sort -u |  uniq -i)"
        dig_op="$(${dig} \
        ${domain} \
        +noall +answer | egrep -o "[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}")"
        echo "${dig_op}" > dig_op.txt
        dig_IP="$(${_cat} \
        dig_op.txt | grep -m 1 "")"
        whoisrun_IP="$(${whois} \
        ${dig_IP} | egrep "Org|Net|CIDR")"
        dig_mail="$(${dig} \
        mx  ${domain} \
        +noall +answer)"
        dig_text="$(${dig} \
        txt ${domain} \
        +noall +answer)"
        dig_auth="$(${dig} \
        txt_dmarc.${domain} \
        +noall +authority)"
        echo "......................................................................................"
        echo "......................................................................................"
        echo "............Starting Information Scans................................................"
        echo "......................................................................................"
        echo "${whoisrun} \n${whoisrun_IP}"
        echo "......................................................................................"
        echo "......................................................................................"
        echo "......................................................................................"
        echo "............IPs of entered domain....................................................."
        echo "......................................................................................"
        echo "Associated IPs with ${domain} are : \n${dig_op}"

else
        echo "............Entered IP is alive......................................................."
        dig_IP_domain=$(dig -x ${domain} +noall +answer | rev | cut -d '.' -f 2,3 | rev)
        whoisrun_IP="$(${whois} \
        ${domain} | egrep "Org|Net|CIDR")"
        whoisrun="$(${whois} \
        ${dig_IP_domain} | egrep "Domain Status|Name|Email|Organization|Phone|Country" | sed -e 's/^[ \t]*//' | tr -d '()' | sort -u |  uniq -i)"
        dig_mail="$(${dig} \
        mx  ${dig_IP_domain} \
        +noall +answer)"
        dig_text="$(${dig} \
        ${dig_IP_domain} \
        +noall +answer)"
        dig_auth="$(${dig} \
        txt_dmarc.${dig_IP_domain} \
        +noall +authority)"
        echo "......................................................................................"
        echo "......................................................................................"
        echo "............Starting Information Scans................................................"
        echo "......................................................................................"
        echo "${whoisrun} \n${whoisrun_IP}"
fi

echo "......................................................................................"
echo "......................................................................................"
echo "......................................................................................"
echo "............Mail Server of entered domain............................................."
echo "......................................................................................"
echo "${dig_mail}"
echo "......................................................................................"
echo "......................................................................................"
echo "......................................................................................"
echo "............Text Record of the entered domain........................................."
echo "......................................................................................"
echo "${dig_text}"
echo "......................................................................................"
echo "......................................................................................"
echo "......................................................................................"
echo "............Server with DNS query answering authority................................."
echo "......................................................................................"
echo "${dig_auth}"
echo "......................................................................................"
echo "......................................................................................"
echo "............Script Ended!! ..........................................................."
echo "......................................................................................"
echo "............THANK YOU!! .............................................................."
echo "......................................................................................"

